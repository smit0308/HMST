<form method="post" action="{% url 'assign_medicine' appointment.id %}">
    {% csrf_token %}
  
    <!-- Hidden input field for patient's username -->
    <input type="text" name="appointment_id" class="form-control bg-white border-0" style="height: 55px; margin-top: 15px;" id="appointment_id" value="{{ appointment.id }}" hidden>
    
    <div id="medicines-container" style="margin-top: 15px;">
        <div class="medicine-entry">
            <label for="medicine">Select Medicine:</label>
            <select name="medicine_id[]" id="medicine">
                {% for medicine in medicines %}
                    <option value="{{ medicine.id }}">{{ medicine.name }} - ${{ medicine.price }}</option>
                {% endfor %}
            </select>
            <br><br>
            <label for="quantity">Quantity:</label>
            <input type="number" name="quantity[]" id="quantity" value="1" min="1">
            <br><br>
            <label for="time">Medicine Time:</label>
            <input type="text" name="time[]" id="time" placeholder="e.g., 1-0-1"> <hr>
        </div>
    </div>
    <button type="button" onclick="addMedicine()">Add Another Medicine</button>
    <br><br>
    <label for="prescription">prescription:</label>
    <input type="text" name="prescription" id="prescription" placeholder="prescription">
    <br><br>

    <label for="need_admit">Do you need to admit?</label>
    <select name="need_admit" id="need_admit" onchange="toggleRoomAllocation()">
        <option value="no">No</option>
        <option value="yes">Yes</option>
    </select>
    <br><br>

    <label for="need_additional_services">Do you need to add other services charges?</label>
    <select name="need_additional_services" id="need_additional_services" onchange="toggleAdditionalServices()">
        <option value="no">No</option>
        <option value="yes">Yes</option>
    </select>
    <br><br>

    <div id="services-container" style="display: none;">
        <h2>Additional Services</h2>
        <div class="service-entry">
            <label for="service_name">Service Name:</label>
            <input type="text" name="service_name[]" id="service_name">
            <br><br>
            <label for="service_quantity">Quantity:</label>
            <input type="number" name="service_quantity[]" id="service_quantity" value="1" min="1">
            <br><br>
            <label for="service_price">Price:</label>
            <input type="number" name="service_price[]" id="service_price" step="0.01" min="0">
            <br><br>
        </div>
        <button type="button" onclick="addService()">Add Another Service</button>
        <hr>
    </div>
    
    <!-- Room Allocation section is removed since the patient selects the room type -->
    
    <button type="submit">Submit</button>
    <br><hr>
</form>